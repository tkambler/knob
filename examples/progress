#!/usr/bin/env NODE_OPTIONS=--no-warnings knob

process.env.NODE_NO_WARNINGS = '1';
process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';

module.exports = async ({ ProgressBar, axios, ora, Bluebird }) => {
  console.log(ProgressBar);
  return;

  const spinner = ora('Fetching todos...').start();

  let { data: todos } = await axios.get(
    'https://jsonplaceholder.typicode.com/todos'
  );

  spinner.succeed(`${todos.length.toLocaleString()} todo(s) fetched.`);

  const bar = new ProgressBar('[:bar] :percent :etas', {
    total: todos.length,
  });

  todos = await Bluebird.map(
    todos,
    async (todo) => {
      const data = await axios.get(
        `https://jsonplaceholder.typicode.com/todos/${todo.id}`
      );
      bar.tick();
      return data;
    },
    {
      concurrency: 1,
    }
  );

  console.log(JSON.stringify(todos, null, 2));

  console.log('All done.');
};
